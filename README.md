Тестовое задание в RTSoft
=========================

## Задача
Задача - сделать сервис просмотра контента.
Он должен представлять из себя простой веб-сервис написанный на python 3 с использованием любых показавшихся необходимыми библиотек.

Есть неизменяемый файл конфигурации в CSV, который содержит данные вида:

Image_URL;needed_amount_of_shows;category1;category2;category3; … ;category N

Количество записей в файле не более 1000. 
Файл содержит только символы.
Необходимое количество показов  - сколько раз картинку нужно показать. 
Категорий у одной картинки может быть от 1 до 10 штук, записанных в соответствующих колонках.

При запуске сервис считывает конфигурационный файл и начинает слушать HTTP обращения.

Клиент HTTP GET запросом сообщает категории, которые он готов принять, к примеру:  
http://127.0.0.1/api/v1/images/html?category=flight&category=show  
Количество запрошенных категорий может быть от 0 до 10 штук.

В ответ на него сервис должен выдавать простую HTML обертку с изображением картинки, которая совпадает минимум по одной категории.
Категории картинки произвольны если в запросе категорий не указано. 
Каждый показ вычитается из количества необходимых к показу.

По характеру запросов считаем, что:
1. не будут запрашиваться категории, которых нет в конфигурационном файле.
2. количество запрошенных категорий равновероятно в рамках 0-10.
3. появление любой из категорий в запросе равновероятно.

Дополнительные плюсы:
1. Код соответствует PEP8.
2. Механизм, который уменьшает вероятность выдачи одной и той же картинки несколько раз подряд 
3. Механизм, позволяющий минимизировать вероятность возникновения случаев, когда подходящие картинки уже исчерпали свой лимит и ответить на запрос нечем.

## Зависимости
- Docker
- Docker Compose

## Установка
1. Клонирование репозитория `git clone https://github.com/Shuich1/RTSoft_test.git`
2. Создание переменных окружения (переименуйте файл `sample.env` в `.env`)
3. Запуск сервисов `docker-compose up --build`
4. Остановка сервисов `docker-compose down`

## Использование

Документация к сервису просмотра контента доступна по адресу: http://127.0.0.1/api/openapi
Сервис предоставляет пару эндпоинтов: 
1. http://127.0.0.1/api/v1/images возвращает JSON объект с информацией о картинке.
2. http://127.0.0.1/api/v1/images/html возвращает HTML представление.

Эндпоинты принимают параметры category, которые позволяют выбрать, к какой категории будет относиться
выведенная картинка. Если категория не выбрана или картинки данной категории отсутствуют, пользователь получает случайную картинку. Предусмотрен механизм, который уменьшает вероятность выдачи одной и той же картинки несколько раз подряд с помощью кэширования в Redis.

Пример использования эндпоинтов с параметрами:
1. http://127.0.0.1/api/v1/images/html?category=flight&category=show
2. http://127.0.0.1/api/v1/images/html?category=games

## Примечание
В ветке async находится решение с асинхронной реализацией хранилища